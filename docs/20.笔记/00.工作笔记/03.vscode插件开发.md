---
title: vscode插件开发
date: 2024-08-24 15:41:19
permalink: /pages/c86b2d9b44336/
categories:
  - 笔记
  - 工作笔记
tags:
  - 
---

## 创建项目

安装依赖

```shell
pnpm i -g yo generate-code
```

初始化插件目录

```shell
yo code
```

> 注：如果报错：You don't seem to have a generator with the name “generator-code” installed. 就先执行npm install generator-code.

<!-- more -->

## 目录结构

```json
{
  "name": "i18n-automatically", // 定义了插件的包名，它必须是唯一的并且符合 npm 的包命名规范。
  "displayName": "I18n Automatically",  // 定义了插件在 Visual Studio Code 中显示的名称。
  "description": "vscode国际化多语言自动生成替换方案",
  "version": "0.0.1", 
  "engines": {
    "vscode": "^1.92.0"   // 定义了插件所支持的 Visual Studio Code 的最低版本。
  },
  "categories": [   // 定义了插件所属的分类，以便在 Visual Studio Code 中组织和展示插件。
    "Extension Packs",
    "Programming Languages",
    "Visualization",
    "Debuggers",
    "Notebooks"
  ],
  "activationEvents": [],    //  定义了激活插件的事件
  "main": "./out/extension.js",  // 定义插件的入口文件
  "contributes": {
    "commands": [
      {
        "command": "i18n-automatically.mytest",  // 注册的插件命令
        "title": "mytest"
      }
    ]
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "pretest": "npm run compile && npm run lint",
    "lint": "eslint src --ext ts",
    "test": "node ./out/test/runTest.js",
    "prepare": "husky install",
    "commitlint": "commitlint --config commitlint.config.js -e -V"
  },
  "devDependencies": {},
  "lint-staged": {
    "**/*": "prettier --write --ignore-unknown"
  }
}
```

## 运行插件

1. F5 运行插件 vsode会打开一个新的调试窗口
![20240824153005](https://gcore.jsdelivr.net/gh/wu529778790/image/blog/20240824153005.png)

2. 在新的调试窗口中，按 ctrl + shift + p，打开命令面板；

3. 输入注册的插件命令，即可执行插件。 在package.json和extension文件中定义了命令，项目的默认命令是hello word，可自行更改。

## 功能实现

extension.ts作为项目的入口文件，里面的两个函数定义了插件激活/销毁时要执行的功能：

```js
// 模块“vscode”包含VS Code可扩展性API
// 导入模块，并在下面的代码中使用别名vscode引用它
const vscode = require("vscode");

// 当您的扩展被激活时，会调用此方法
// 您的扩展在第一次执行命令时被激活

/**
 * @param {vscode.ExtensionContext} context
 */
function activate(context) {
  // 使用控制台输出诊断信息（console.log）和错误（console.error）
  // 当您的扩展被激活时，这行代码只会执行一次
  console.log(
    'Congratulations, your extension "i18n-automatically" is now active!'
  );

  // 该命令已在package.json文件中定义
  // 现在使用registerCommand提供命令的实现
  // commandId参数必须与package.json中的命令字段匹配
  const disposable = vscode.commands.registerCommand(
    "i18n-automatically.helloWorld",
    function () {
      // The code you place here will be executed every time your command is executed

      // Display a message box to the user
      vscode.window.showInformationMessage(
        "Hello World from i18n-automatically!"
      );
    }
  );

  context.subscriptions.push(disposable);
}

// This method is called when your extension is deactivated
function deactivate() {}

module.exports = {
  // 插件激活
  activate,
  // 插件销毁
  deactivate,
};
```

剩下的开发和平时一样。

## 打包发布

### 账号准备

<https://marketplace.visualstudio.com/manage>

### package.json修改

新增 publisher: publisher ID

### 打包命令

安装依赖

```shell
pnpm i -g vsce
```

打包,在根目录下执行打包命令，执行成功后，会在根目录下生成 .vsix 文件

```shell
vsce package
```

### 发布

- 命令发布

```shell
vsce publish -p YOUR_PUBLISHER_ID
```
