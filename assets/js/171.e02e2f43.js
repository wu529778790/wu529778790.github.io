(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{508:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",{attrs:{"data-nodeid":"3596"}},[t._v("前端工程化和基础建设这个话题，自然少不了分析构建工具。作为前端工程中最常见、最经典的构建工具，Webpack 必须要有一个独立小节进行精讲。可是，关于 Webpack 什么样的内容才更有意义呢？当前社区，Webpack 插件编写、loader 编写相关内容已经非常多了，甚至 Tapable 机制也已经有了涉猎。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3597"}},[t._v("这一讲，我们独辟蹊径，从 Webpack 的实现入手，帮助你构建一个自己的工程化工具。")]),t._v(" "),a("h3",{attrs:{"data-nodeid":"3598"}},[t._v("Webpack 的初心和揭秘")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3599"}},[t._v("我不建议对着 Webpack 源码讲解，因为 Webpack 是一个庞大的体系，其源码逐行讲解太过枯燥，真正能转化在技术积累上的内容较少。今天，我们先抽丝剥茧，从 Webpack 的使命谈起，相信你会有一个更加清晰的认知。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3600"}},[t._v("Webpack 的介绍只有简单一句：")]),t._v(" "),a("blockquote",{attrs:{"data-nodeid":"3601"}},[a("p",{attrs:{"data-nodeid":"3602"}},[t._v("Webpack is a static module bundler for modern JavaScript applications.")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3603"}},[t._v("虽然 Webpack 看上去无所不能，但从其本质上来说，Webpack 实质就是一个“前端模块打包器”。前端模块打包器做的事情很简单：它帮助开发者将 JavaScript 模块（各种类型的模块化规范）打包为一个或多个 JavaScript 脚本文件。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3604"}},[t._v("我们回到最初起源，前端为什么需要一个模块打包器呢？其实理由很简单：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3605"}},[a("li",{attrs:{"data-nodeid":"3606"}},[a("p",{attrs:{"data-nodeid":"3607"}},[t._v("不是所有浏览器都直接支持 JavaScript 规范；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3608"}},[a("p",{attrs:{"data-nodeid":"3609"}},[t._v("前端需要管理依赖脚本，把控不同脚本加载的顺序；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3610"}},[a("p",{attrs:{"data-nodeid":"3611"}},[t._v("前端需要按顺序加载不同类型的静态资源。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3612"}},[t._v("想象一下，我们的 Web 应用有这样一段内容：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3613"}},[a("code",{attrs:{"data-language":"java"}},[t._v('<html>\n  <script src="/src/1.js"><\/script>\n  <script src="/src/2.js"><\/script>\n  <script src="/src/3.js"><\/script>\n  <script src="/src/4.js"><\/script>\n  <script src="/src/5.js"><\/script>\n  <script src="/src/6.js"><\/script>\n</html>\n')])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3614"}},[t._v("每个 JavaScript 文件都需要额外的 HTTP 请求获取，并且因为依赖关系，"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3778"}},[t._v("1.js")]),t._v("到"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3780"}},[t._v("6.js")]),t._v("需要按顺序加载。因此，打包需求应运而生：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3615"}},[a("code",{attrs:{"data-language":"java"}},[t._v('<html>\n  <script src="/dist/bundle.js"><\/script>\n</html>\n')])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3616"}},[t._v("这里需要注意几点：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"5616"}},[a("li",{attrs:{"data-nodeid":"5617"}},[a("p",{attrs:{"data-nodeid":"5618"}},[t._v("随着 HTTP/2 技术的推广，未来长远上看，浏览器像上述代码一样发送多个请求不再是性能瓶颈，但目前来看还过于乐观（更多内容参见 "),a("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/http2/","data-nodeid":"5624"}},[t._v("HTTP/2 简介")]),t._v("）；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"5619"}},[a("p",{attrs:{"data-nodeid":"5620"}},[a("strong",{attrs:{"data-nodeid":"5636"}},[t._v("并不是将所有脚本都打包在一起就是性能最优")]),t._v("，"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"5630"}},[t._v("/dist/bundle.js")]),t._v("的 size 一般较大，但这属于另外“性能优化”话题了，相关内容，我们在"),a("a",{attrs:{href:"https://kaiwu.lagou.com/course/courseInfo.htm?courseId=584#/detail/pc?id=5915","data-nodeid":"5634"}},[t._v("10 讲“代码拆分和按需加载：缩减 bundle size，把性能做到极致”")]),t._v("中已有涉及。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3622"}},[t._v("总之，打包器的需求就是前端“刚需”，实现上述打包需要也并不简单，需要考虑：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3623"}},[a("li",{attrs:{"data-nodeid":"3624"}},[a("p",{attrs:{"data-nodeid":"3625"}},[t._v("如何维护不同脚本的打包顺序，保证"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3801"}},[t._v("bundle.js")]),t._v("的可用性；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3626"}},[a("p",{attrs:{"data-nodeid":"3627"}},[t._v("如何避免不同脚本、不同模块的命名冲突；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3628"}},[a("p",{attrs:{"data-nodeid":"3629"}},[t._v("在打包过程中，如何确定真正需要的脚本，而不将没有用到的脚本排除在"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3805"}},[t._v("bundle.js")]),t._v("之外？")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3630"}},[t._v("事实上，虽然当前 Webpack 依靠 loader 机制实现了对于不同类型资源的解析和打包，依靠插件机制实现了第三方介入编译构建的过程，但究其本质，Webpack 只是一个“无所不能”的打包器，实现了：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3631"}},[a("code",{attrs:{"data-language":"java"}},[t._v("a.js + b.js + c.js. => bundle.js\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3632"}},[t._v("的能力。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3633"}},[t._v("下面我们继续揭秘 Webpack 在打包过程中的奥秘。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3634"}},[t._v("为了简化，我们以 ESM 模块化规范举例。假设我们有：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3635"}},[a("li",{attrs:{"data-nodeid":"3636"}},[a("p",{attrs:{"data-nodeid":"3637"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3811"}},[t._v("circle.js")]),t._v("模块求圆形面积；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3638"}},[a("p",{attrs:{"data-nodeid":"3639"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3813"}},[t._v("square.js")]),t._v("模块求正方形面积；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3640"}},[a("p",{attrs:{"data-nodeid":"3641"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3815"}},[t._v("app.js")]),t._v("模块作为主模块。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3642"}},[t._v("对应内容分别如下代码：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3643"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-comment"},[t._v("// filename: circle.js")]),t._v("\n"),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" PI = "),a("span",{staticClass:"hljs-number"},[t._v("3.141")]),t._v(";\n"),a("span",{staticClass:"hljs-function"},[t._v("export "),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(" function "),a("span",{staticClass:"hljs-title"},[t._v("area")]),a("span",{staticClass:"hljs-params"},[t._v("(radius)")]),t._v(" ")]),t._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" PI * radius * radius;\n}\n"),a("span",{staticClass:"hljs-comment"},[t._v("// filename: square.js")]),t._v("\n"),a("span",{staticClass:"hljs-function"},[t._v("export "),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(" function "),a("span",{staticClass:"hljs-title"},[t._v("area")]),a("span",{staticClass:"hljs-params"},[t._v("(side)")]),t._v(" ")]),t._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" side * side;\n}\n"),a("span",{staticClass:"hljs-comment"},[t._v("// filename: app.js")]),t._v("\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" squareArea from "),a("span",{staticClass:"hljs-string"},[t._v("'./square'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" circleArea from "),a("span",{staticClass:"hljs-string"},[t._v("'./circle'")]),t._v(";\nconsole.log("),a("span",{staticClass:"hljs-string"},[t._v("'Area of square: '")]),t._v(", squareArea("),a("span",{staticClass:"hljs-number"},[t._v("5")]),t._v("));\nconsole.log("),a("span",{staticClass:"hljs-string"},[t._v("'Area of circle'")]),t._v(", circleArea("),a("span",{staticClass:"hljs-number"},[t._v("5")]),t._v("));\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3644"}},[t._v("经过 Webpack 打包之后，我们用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3819"}},[t._v("bundle.js")]),t._v("来表示 Webpack 处理结果（精简并可读化处理后）：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3645"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-comment"},[t._v("// filename: bundle.js")]),t._v("\n"),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" modules = {\n  "),a("span",{staticClass:"hljs-string"},[t._v("'circle.js'")]),t._v(": function("),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(", require) {\n    "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" PI = "),a("span",{staticClass:"hljs-number"},[t._v("3.141")]),t._v(";\n    "),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v("."),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(" = "),a("span",{staticClass:"hljs-function"},[t._v("function "),a("span",{staticClass:"hljs-title"},[t._v("area")]),a("span",{staticClass:"hljs-params"},[t._v("(radius)")]),t._v(" ")]),t._v("{\n      "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" PI * radius * radius;\n    }\n  },\n  "),a("span",{staticClass:"hljs-string"},[t._v("'square.js'")]),t._v(": function("),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(", require) {\n    "),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v("."),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(" = "),a("span",{staticClass:"hljs-function"},[t._v("function "),a("span",{staticClass:"hljs-title"},[t._v("area")]),a("span",{staticClass:"hljs-params"},[t._v("(side)")]),t._v(" ")]),t._v("{\n      "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" side * side;\n    }\n  },\n  "),a("span",{staticClass:"hljs-string"},[t._v("'app.js'")]),t._v(": function("),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(", require) {\n    "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" squareArea = require("),a("span",{staticClass:"hljs-string"},[t._v("'square.js'")]),t._v(")."),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(";\n    "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" circleArea = require("),a("span",{staticClass:"hljs-string"},[t._v("'circle.js'")]),t._v(")."),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(";\n    console.log("),a("span",{staticClass:"hljs-string"},[t._v("'Area of square: '")]),t._v(", squareArea("),a("span",{staticClass:"hljs-number"},[t._v("5")]),t._v("))\n    console.log("),a("span",{staticClass:"hljs-string"},[t._v("'Area of circle'")]),t._v(", circleArea("),a("span",{staticClass:"hljs-number"},[t._v("5")]),t._v("))\n  }\n}\nwebpackBundle({\n  modules,\n  entry: "),a("span",{staticClass:"hljs-string"},[t._v("'app.js'")]),t._v("\n});\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3646"}},[t._v("如上代码，我们维护了"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3822"}},[t._v("modules")]),t._v("变量，存储了不同模块信息，这个 map 中，key 为模块路径名，value 为一个被 wrapped 过的模块函数，我们先称之为"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3824"}},[t._v("module factory function")]),t._v("，该函数形如：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3647"}},[a("code",{attrs:{"data-language":"java"}},[t._v("function("),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(", require) {\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 模块内容")]),t._v("\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3648"}},[t._v("这样做是为每个模块提供"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3827"}},[t._v("exports")]),t._v("和"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3829"}},[t._v("require")]),t._v("能力，同时"),a("strong",{attrs:{"data-nodeid":"3835"}},[t._v("保证了每个模块都处于一个隔离的函数作用域范围")]),t._v("。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3649"}},[t._v("有了"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3837"}},[t._v("modules")]),t._v("变量还不够，我们依赖"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3839"}},[t._v("webpackBundle")]),t._v("方法，将所有内容整合在一起。"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3841"}},[t._v("webpackBundle")]),t._v("方法接收"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3843"}},[t._v("modules")]),t._v("模块信息以及一个入口脚本。代码如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("webpackBundle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" entry "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" moduleCache "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("require")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("moduleName")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果已经解析并缓存过，直接返回缓存内容")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moduleCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("moduleName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" moduleCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("moduleName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里是为了防止循环引用")]),t._v("\n    moduleCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("moduleName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行模块内容，如果遇见了 require 方法，则继续递归执行 require 方法 ")]),t._v("\n    modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("moduleName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" moduleCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("moduleName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",{attrs:{"data-nodeid":"3651"}},[t._v("上述代码中需要注意："),a("strong",{attrs:{"data-nodeid":"3853"}},[t._v("webpackBundle 方法中声明的")]),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3849"}},[t._v("require")]),t._v("方法和 CommonJS 规范中的 require 是两回事，该"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3851"}},[t._v("require")]),t._v("方法是 Webpack 自己实现的模块化解决方案。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3652"}},[t._v("我们通过下图来总结一下 Webpack 风格的打包器原理和流程：")]),t._v(" "),a("p",{attrs:{"data-nodeid":"7255"}},[a("img",{attrs:{src:"https://s0.lgstatic.com/i/image/M00/91/75/Ciqc1GAOlIOAYZLfAAFmQUf14uQ501.png",alt:"Lark20210125-174549.png","data-nodeid":"7259"}})]),t._v(" "),a("div",{attrs:{"data-nodeid":"7256"}},[a("p",{staticStyle:{"text-align":"center"}},[t._v("Webpack 打包器原理和流程图")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3655"}},[t._v("讲到这里，我们再扩充一下另一个打包器——Rollup 的打包原理，针对上述代码，Rollup 打包过后的产出为：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3656"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" PI = "),a("span",{staticClass:"hljs-number"},[t._v("3.141")]),t._v(";\nfunction circle$area(radius) {\n  "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" PI * radius * radius;\n}\nfunction square$area(side) {\n  "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" side * side;\n}\nconsole.log("),a("span",{staticClass:"hljs-string"},[t._v("'Area of square: '")]),t._v(", square$area("),a("span",{staticClass:"hljs-number"},[t._v("5")]),t._v("));\nconsole.log("),a("span",{staticClass:"hljs-string"},[t._v("'Area of circle'")]),t._v(", circle$area("),a("span",{staticClass:"hljs-number"},[t._v("5")]),t._v("));\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3657"}},[t._v("如上代码，我们看到，Rollup 的原理思想与 Webpack 不同："),a("strong",{attrs:{"data-nodeid":"3865"}},[t._v("Rollup 不会维护一个 module map，而是将所有模块拍平（flatten）放到 bundle 中")]),t._v("，也就不存在包裹函数（module factory function）。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3658"}},[t._v("为了保证命名冲突不出现，Rollup 将函数和变量名进行了改写，在模块脚本"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3867"}},[t._v("circle.js")]),t._v("和"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3869"}},[t._v("square.js")]),t._v("中，都命名了一个"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3871"}},[t._v("area")]),t._v("方法。经过 Rollup 打包后，"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3873"}},[t._v("area")]),t._v("方法根据模块主体，进行了重命名。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3659"}},[t._v("我们将 Webpack 和 Rollup 的打包方式进行对比总结。")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3660"}},[a("li",{attrs:{"data-nodeid":"3661"}},[a("p",{attrs:{"data-nodeid":"3662"}},[t._v("Webpack 理念：")])])]),t._v(" "),a("ol",{attrs:{"data-nodeid":"3663"}},[a("li",{attrs:{"data-nodeid":"3664"}},[a("p",{attrs:{"data-nodeid":"3665"}},[t._v("使用了 module map，维护项目中的依赖关系；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3666"}},[a("p",{attrs:{"data-nodeid":"3667"}},[t._v("使用了包裹函数，对每个模块进行包裹；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3668"}},[a("p",{attrs:{"data-nodeid":"3669"}},[t._v("使用了一个“runtime”方法（这里举例为"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3880"}},[t._v("webpackBundle")]),t._v("），最终合成 bundle 内容。")])])]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3670"}},[a("li",{attrs:{"data-nodeid":"3671"}},[a("p",{attrs:{"data-nodeid":"3672"}},[t._v("Rollup 理念：")])])]),t._v(" "),a("ol",{attrs:{"data-nodeid":"3673"}},[a("li",{attrs:{"data-nodeid":"3674"}},[a("p",{attrs:{"data-nodeid":"3675"}},[t._v("将每个模块拍平；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3676"}},[a("p",{attrs:{"data-nodeid":"3677"}},[t._v("不使用包裹函数，不需要对每个模块进行包裹。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3678"}},[t._v("不同的理念也会造成不同的打包结果，这里我想给你留一个思考题："),a("strong",{attrs:{"data-nodeid":"3890"}},[t._v("在 Rollup 处理理念下，如果模块出现了循环依赖，会发生什么现象呢")]),t._v("？")]),t._v(" "),a("h3",{attrs:{"data-nodeid":"3679"}},[t._v("手动实现打包器")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3680"}},[t._v("前面内容我们剖析了以 Webpak、Rollup 为代表的打包器核心原理。下面内容，我们将手动实现一个自己的简易打包器，我们的目标将会向 Webpack 打包设计对齐。核心思路如下：")]),t._v(" "),a("ol",{attrs:{"data-nodeid":"3681"}},[a("li",{attrs:{"data-nodeid":"3682"}},[a("p",{attrs:{"data-nodeid":"3683"}},[t._v("读取入口文件（比如"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3894"}},[t._v("entry.js")]),t._v("）；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3684"}},[a("p",{attrs:{"data-nodeid":"3685"}},[t._v("基于 AST 分析入口文件，并产出依赖列表；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3686"}},[a("p",{attrs:{"data-nodeid":"3687"}},[t._v("使用 Babel 将相关模块编译到 ES5；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3688"}},[a("p",{attrs:{"data-nodeid":"3689"}},[t._v("对每个依赖模块产出一个唯一的 ID，方便后续读取模块相关内容；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3690"}},[a("p",{attrs:{"data-nodeid":"3691"}},[t._v("将每个依赖以及经过 Babel 编译过后的内容，存储在一个对象中进行维护；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3692"}},[a("p",{attrs:{"data-nodeid":"3693"}},[t._v("遍历上一步中的对象，构建出一个依赖图（Dependency Graph）；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3694"}},[a("p",{attrs:{"data-nodeid":"3695"}},[t._v("将各模块内容 bundle 产出。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3696"}},[t._v("我们来一步一步实现。首先创建项目：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3697"}},[a("code",{attrs:{"data-language":"java"}},[t._v("mkdir bundler-playground && cd $_\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3698"}},[t._v("并启动 npm：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3699"}},[a("code",{attrs:{"data-language":"java"}},[t._v("npm init -y\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3700"}},[t._v("安装以下依赖：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3701"}},[a("li",{attrs:{"data-nodeid":"3702"}},[a("p",{attrs:{"data-nodeid":"3703"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3905"}},[t._v("@babel/parser")]),t._v("用于分析源代码，产出 AST；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3704"}},[a("p",{attrs:{"data-nodeid":"3705"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3907"}},[t._v("@babel/traverse")]),t._v("用于遍历 AST，找到 import 声明；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3706"}},[a("p",{attrs:{"data-nodeid":"3707"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3909"}},[t._v("@babel/core")]),t._v("用于编译，将源代码编译为 ES5；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3708"}},[a("p",{attrs:{"data-nodeid":"3709"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3911"}},[t._v("@babel/preset-env")]),t._v("搭配"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3913"}},[t._v("@babel/core")]),t._v("使用；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3710"}},[a("p",{attrs:{"data-nodeid":"3711"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"3915"}},[t._v("resolve")]),t._v("用于获取依赖的绝对路径。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3712"}},[t._v("相关命令：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("npm install "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save @babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("parser @babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("traverse @babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("core  @babel"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("preset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("env resolve\n")])])]),a("p",{attrs:{"data-nodeid":"3714"}},[t._v("做完了这些，我们开始核心逻辑的编写，创建"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3919"}},[t._v("index.js")]),t._v("，并引入如下依赖代码：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/parser"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" traverse "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/traverse"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" babel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/core"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" resolve "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resolve"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sync"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",{attrs:{"data-nodeid":"3716"}},[t._v("接着，我们维护一个全局 ID，并通过遍历 AST，访问"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3922"}},[t._v("ImportDeclaration")]),t._v("节点，收集依赖到"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3924"}},[t._v("deps")]),t._v("数组中，同时完成 Babel 降级编译：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ID")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createModuleInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("filePath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读取模块源代码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" content "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"utf-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对源代码进行 AST 产出")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ast "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" parser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sourceType")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 相关模块依赖数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" deps "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 遍历模块 AST，将依赖推入 deps 数组中")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("traverse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("ImportDeclaration")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" node "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          deps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 编译为 ES5")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" babel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformFromAstSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("presets")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        filePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        deps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        code\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",{attrs:{"data-nodeid":"3718"}},[t._v("上述代码中，相关注释已经比较明晰了。这里需要指出的是，我们采用了"),a("strong",{attrs:{"data-nodeid":"3935"}},[t._v("自增 ID")]),t._v("的方式，"),a("strong",{attrs:{"data-nodeid":"3936"}},[t._v("如果采用随机的 GUID，会是更安全的做法")]),t._v("。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3719"}},[t._v("至此，我们实现了对一个模块的分析，并产出：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3720"}},[a("li",{attrs:{"data-nodeid":"3721"}},[a("p",{attrs:{"data-nodeid":"3722"}},[t._v("该模块对应 ID；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3723"}},[a("p",{attrs:{"data-nodeid":"3724"}},[t._v("该模块路径；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3725"}},[a("p",{attrs:{"data-nodeid":"3726"}},[t._v("该模块的依赖数组；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3727"}},[a("p",{attrs:{"data-nodeid":"3728"}},[t._v("该模块经过 Babel 编译后的代码。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3729"}},[t._v("接下来，我们生成整个项目的依赖树（Dependency Graph）。代码如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDependencyGraph")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("entry")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取模块信息")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" entryInfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createModuleInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 项目依赖树")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" graphArr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    graphArr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entryInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以入口模块为起点，遍历整个项目依赖的模块，并将每个模块信息维护到 graphArr 中")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" module "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" graphArr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("depPath")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" baseDir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dirname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" moduleDepPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("depPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" baseDir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" moduleInfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createModuleInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moduleDepPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            graphArr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moduleInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("depPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" moduleInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" graphArr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",{attrs:{"data-nodeid":"3731"}},[t._v("上述代码中，我们使用一个数组类型的变量"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3944"}},[t._v("graphArr")]),t._v("来描述整个项目的依赖树情况。最后，我们基于"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3946"}},[t._v("graphArr")]),t._v("内容，将相关模块进行打包。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("graph")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" moduleArgArr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" graph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(": {\n            factory: (exports, require) => {\n                ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n            },\n            map: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n        }")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" iifeBundler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("(function(modules){\n        const require = id => {\n            const {factory, map} = modules[id];\n            const localRequire = requireDeclarationName => require(map[requireDeclarationName]);\n            const module = {exports: {}};\n            factory(module.exports, localRequire);\n            return module.exports;\n        }\n        require(0);\n\n        })({")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("moduleArgArr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("})\n    ")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" iifeBundler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",{attrs:{"data-nodeid":"3733"}},[t._v("如上代码，我们创建一个对应每个模块的模板对象：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3734"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" `${"),a("span",{staticClass:"hljs-keyword"},[t._v("module")]),t._v(".id}: {\n  factory: ("),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(", require) => {\n    ${"),a("span",{staticClass:"hljs-keyword"},[t._v("module")]),t._v(".code}\n  },\n  map: ${JSON.stringify("),a("span",{staticClass:"hljs-keyword"},[t._v("module")]),t._v(".map)}\n  }`;\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3735"}},[t._v("在"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3950"}},[t._v("factory")]),t._v("对应的内容中，我们包裹模块代码，并注入"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3952"}},[t._v("exports")]),t._v("和"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3954"}},[t._v("require")]),t._v("两个参数。同时，我们构造了一个 IIFE 风格的代码区块，用于将依赖树中的代码串联在一起。最难理解的部分在于：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"3736"}},[a("code",{attrs:{"data-language":"java"}},[t._v("  "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" iifeBundler = `(function(modules){\n    "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" require = id => {\n      "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" {factory, map} = modules[id];\n      "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" localRequire = requireDeclarationName => require(map[requireDeclarationName]);\n      "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" "),a("span",{staticClass:"hljs-keyword"},[t._v("module")]),t._v(" = {"),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(": {}};\n      factory("),a("span",{staticClass:"hljs-keyword"},[t._v("module")]),t._v("."),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(", localRequire);\n      "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" "),a("span",{staticClass:"hljs-keyword"},[t._v("module")]),t._v("."),a("span",{staticClass:"hljs-keyword"},[t._v("exports")]),t._v(";\n    }\n    require("),a("span",{staticClass:"hljs-number"},[t._v("0")]),t._v(");\n  })({${moduleArgArr.join()}})\n  `;\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3737"}},[t._v("针对这段代码，我们进行更细致的分析。")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3738"}},[a("li",{attrs:{"data-nodeid":"3739"}},[a("p",{attrs:{"data-nodeid":"3740"}},[t._v("使用 IIFE 的方式，来保证模块变量不会影响到全局作用域。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3741"}},[a("p",{attrs:{"data-nodeid":"3742"}},[t._v("构造好的项目依赖树（Dependency Graph）数组，将会作为名为"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3959"}},[t._v("modules")]),t._v("的行参，传递给 IIFE。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3743"}},[a("p",{attrs:{"data-nodeid":"3744"}},[t._v("我们构造了"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3962"}},[t._v("require(id)")]),t._v("方法，这个方法的意义在于：")])])]),t._v(" "),a("ol",{attrs:{"data-nodeid":"3745"}},[a("li",{attrs:{"data-nodeid":"3746"}},[a("p",{attrs:{"data-nodeid":"3747"}},[t._v("通过"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3965"}},[t._v("require(map[requireDeclarationName])")]),t._v("方式，按顺序递归调用各个依赖模块；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3748"}},[a("p",{attrs:{"data-nodeid":"3749"}},[t._v("通过调用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3968"}},[t._v("factory(module.exports, localRequire)")]),t._v("执行模块相关代码；")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3750"}},[a("p",{attrs:{"data-nodeid":"3751"}},[t._v("该方法最终返回"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3971"}},[t._v("module.exports")]),t._v("对象，module.exports 最初值为空对象（"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3973"}},[t._v("{exports: {}}")]),t._v("），但在一次次调用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3975"}},[t._v("factory()")]),t._v("函数后，"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"3977"}},[t._v("module.exports")]),t._v("对象内容已经包含了模块对外暴露的内容了。")])])]),t._v(" "),a("h3",{attrs:{"data-nodeid":"3752"}},[t._v("总结")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3753"}},[t._v("这一讲虽然标题包含“解析 Webpack 源码”，但我们并没有采用源码解读的方式展开，而是从打包器的设计原理入手，换一种角度进行 Webpack 源码解读，并最终动手实现了一个自己的简易打包器。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3754"}},[t._v("实际上，打包过程主要分为两步："),a("strong",{attrs:{"data-nodeid":"3990"}},[t._v("依赖解析")]),t._v("（Dependency Resolution）和"),a("strong",{attrs:{"data-nodeid":"3991"}},[t._v("代码打包")]),t._v("（Bundling）：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"3755"}},[a("li",{attrs:{"data-nodeid":"3756"}},[a("p",{attrs:{"data-nodeid":"3757"}},[t._v("在依赖解析过程中，我们通过 AST 技术，找到每个模块的依赖模块，并组合为最终的项目依赖树。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"3758"}},[a("p",{attrs:{"data-nodeid":"3759"}},[t._v("在代码打包过程中，我们使用 Babel 对源代码进行编译，其中也包括了对 imports / exports（即对 ESM） 的编译。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"3760"}},[t._v("整个过程稍微有些抽象，需要你用心体会。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3761"}},[t._v("主要内容总结为下图：")]),t._v(" "),a("p",{staticClass:"te-preview-highlight",attrs:{"data-nodeid":"8064"}},[a("img",{attrs:{src:"https://s0.lgstatic.com/i/image2/M01/09/65/Cip5yGAOlKiAA3uyAAG87LhMy8s651.png",alt:"Drawing 1.png","data-nodeid":"8067"}})]),t._v(" "),a("p",{attrs:{"data-nodeid":"3763"}},[t._v("在实际生产环节，打包器当然功能更多，比如需要考虑：code spliting 甚至 watch mode 以及 reloading 能力等。但是不管什么样的特性和能力，只要我们理清最初心，掌握最基本的思想，任何疑问都会迎刃而解。")]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"精选评论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#精选评论"}},[t._v("#")]),t._v(" 精选评论")]),t._v(" "),a("h5",{attrs:{id:"帅"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#帅"}},[t._v("#")]),t._v(" *帅")]),t._v(" "),a("blockquote",[a("p",[t._v("妙啊~")])])])}),[],!1,null,null,null);a.default=e.exports}}]);