(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{518:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",{attrs:{"data-nodeid":"1605"}},[t._v("脚手架是工程化中不可缺少的一环。究竟什么是脚手架呢？广义上来说，脚手架就是为了保证各施工过程顺利进行而搭设的工作平台。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1606"}},[t._v("编程领域的脚手架主要为了完成新项目的启动和搭建，能够帮助开发者提升效率和开发体验。对于前端来说，从零开始建立一个项目是复杂的，因此也就存在了较多类型的脚手架：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"1607"}},[a("li",{attrs:{"data-nodeid":"1608"}},[a("p",{attrs:{"data-nodeid":"1609"}},[t._v("Vue/React 框架类脚手架")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1610"}},[a("p",{attrs:{"data-nodeid":"1611"}},[t._v("Webpack 等构建配置类脚手架")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1612"}},[a("p",{attrs:{"data-nodeid":"1613"}},[t._v("混合脚手架，比如大家熟悉的 Vue-cli 或者 create-react-app")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1614"}},[t._v("这一讲我们就深入这些脚手架的原理进行讲解。")]),t._v(" "),a("h3",{attrs:{"data-nodeid":"1615"}},[t._v("命令行工具原理和实现")]),t._v(" "),a("p",{staticClass:"te-preview-highlight",attrs:{"data-nodeid":"6062"}},[t._v("现代脚手架离不开命令行工具，命令行工具即 Command-line interfaces（CLIs） ，是编程领域的重要概念，也是我们开发中经常接触到的工具之一。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1617"}},[t._v("比如 Webpack、Babel、npm、Yarn 等都是典型的命令行。此外，流畅的命令行能够迅速启动一个脚手架，实现"),a("strong",{attrs:{"data-nodeid":"1743"}},[t._v("自动化和智能化")]),t._v("流程。这一部分，我们就使用 Node.js 来开发一个命令行。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1618"}},[t._v("我们先来看几个开发命令行工具的关键依赖。")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"1619"}},[a("li",{attrs:{"data-nodeid":"1620"}},[a("p",{attrs:{"data-nodeid":"1621"}},[a("a",{attrs:{href:"http://npm.im/inquirer","data-nodeid":"1747"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1746"}},[t._v("inquirer")])]),t._v("、"),a("a",{attrs:{href:"http://npm.im/enquirer","data-nodeid":"1751"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1750"}},[t._v("enquirer")])]),t._v("、"),a("a",{attrs:{href:"https://npm.im/prompts","data-nodeid":"1755"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1754"}},[t._v("prompts")])]),t._v("：可以处理复杂的用户输入，完成命令行输入交互。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1622"}},[a("p",{attrs:{"data-nodeid":"1623"}},[a("a",{attrs:{href:"http://npm.im/chalk","data-nodeid":"1759"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1758"}},[t._v("chalk")])]),t._v("、"),a("a",{attrs:{href:"https://npm.im/kleur","data-nodeid":"1763"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1762"}},[t._v("kleur")])]),t._v("：使终端可以输出彩色信息文案。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1624"}},[a("p",{attrs:{"data-nodeid":"1625"}},[a("a",{attrs:{href:"http://npm.im/ora","data-nodeid":"1767"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1766"}},[t._v("ora")])]),t._v("：可以让命令行出现好看的 Spinners。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1626"}},[a("p",{attrs:{"data-nodeid":"1627"}},[a("a",{attrs:{href:"http://npm.im/boxen","data-nodeid":"1771"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1770"}},[t._v("boxen")])]),t._v("：可以在命令行中画出 Boxes 区块。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1628"}},[a("p",{attrs:{"data-nodeid":"1629"}},[a("a",{attrs:{href:"http://npm.im/listr","data-nodeid":"1775"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1774"}},[t._v("listr")])]),t._v("：可以在命令行中画出进度列表。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1630"}},[a("p",{attrs:{"data-nodeid":"1631"}},[a("a",{attrs:{href:"http://npm.im/meow","data-nodeid":"1779"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1778"}},[t._v("meow")])]),t._v("、"),a("a",{attrs:{href:"http://npm.im/arg","data-nodeid":"1783"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1782"}},[t._v("arg")])]),t._v("：可以进行基础的命令行参数解析。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1632"}},[a("p",{attrs:{"data-nodeid":"1633"}},[a("a",{attrs:{href:"http://npm.im/commander","data-nodeid":"1787"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1786"}},[t._v("commander")])]),t._v("、"),a("a",{attrs:{href:"https://www.npmjs.com/package/yargs","data-nodeid":"1791"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1790"}},[t._v("yargs")])]),t._v("：可以进行更加复杂的命令行参数解析。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1634"}},[t._v("我们的目标是支持以下面这种启动方式，建立我们的项目，如下代码：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1635"}},[a("code",{attrs:{"data-language":"java"}},[t._v("npm init "),a("span",{staticClass:"hljs-meta"},[t._v("@lucas")]),t._v("/project\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1636"}},[t._v("npm 6.1 及以上版本，我们都可以使用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1795"}},[t._v("npm init")]),t._v("或"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1797"}},[t._v("yarn create")]),t._v("来启动我们的项目，比如下面两个命令就是等价的：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1637"}},[a("code",{attrs:{"data-language":"java"}},[t._v("# 使用 Node.js\nnpm init @lucas/project\n# 使用 Yarn\nyarn create @lucas/project\n")])]),t._v(" "),a("h4",{attrs:{"data-nodeid":"1638"}},[t._v("启动命令行项目")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1639"}},[t._v("下面开始进入开发，首先我们创建项目：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1640"}},[a("code",{attrs:{"data-language":"java"}},[t._v("mkdir create-project && cd create-project\nnpm init --yes\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1641"}},[t._v("接着进入"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1802"}},[t._v("create-project")]),t._v("文件中，创建"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1804"}},[t._v("src")]),t._v("目录及"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1806"}},[t._v("src/cli.js")]),t._v("文件，"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1808"}},[t._v("cli.js")]),t._v("文件内容如下：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1642"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-function"},[t._v("export function "),a("span",{staticClass:"hljs-title"},[t._v("cli")]),a("span",{staticClass:"hljs-params"},[t._v("(args)")]),t._v(" ")]),t._v("{\n console.log(args);\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1643"}},[t._v("接下来，为了使我们的命令行可以在终端执行，我们新建"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1811"}},[t._v("bin/")]),t._v("目录，并在其下创建一个"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1813"}},[t._v("create-project")]),t._v("文件，代码为：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1644"}},[a("code",{attrs:{"data-language":"java"}},[t._v("#!/usr/bin/env node\nrequire = require('esm')(module /*, options*/);\nrequire('../src/cli').cli(process.argv);\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1645"}},[t._v("上述代码中，我们使用了"),a("a",{attrs:{href:"https://www.npmjs.com/package/esm","data-nodeid":"1819"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1817"}},[t._v("esm")])]),t._v(" 模块，这样就可以在其他文件中使用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1821"}},[t._v("import")]),t._v("关键字，即 ESM 模块规范了。我们在该入口文件中，引入"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1823"}},[t._v("cli.js")]),t._v("并将命令行参数"),a("a",{attrs:{href:"https://nodejs.org/api/process.html#process_process_argv","data-nodeid":"1827"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1826"}},[t._v("process.argv")])]),t._v("传给"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1829"}},[t._v("cli")]),t._v("函数执行。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1646"}},[t._v("当然，为了能够正常使用"),a("a",{attrs:{href:"https://www.npmjs.com/package/esm","data-nodeid":"1835"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1833"}},[t._v("esm")])]),t._v(" 模块，我们需要先安装，执行"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1837"}},[t._v("npm install esm")]),t._v("。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1647"}},[t._v("此时 package.json 内容如下：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1648"}},[a("code",{attrs:{"data-language":"java"}},[t._v("{\n "),a("span",{staticClass:"hljs-string"},[t._v('"name"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"@lucas/create-project"')]),t._v(",\n "),a("span",{staticClass:"hljs-string"},[t._v('"version"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"1.0.0"')]),t._v(",\n "),a("span",{staticClass:"hljs-string"},[t._v('"description"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"A CLI to bootstrap my new projects"')]),t._v(",\n "),a("span",{staticClass:"hljs-string"},[t._v('"main"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"src/index.js"')]),t._v(",\n "),a("span",{staticClass:"hljs-string"},[t._v('"bin"')]),t._v(": {\n   "),a("span",{staticClass:"hljs-string"},[t._v('"@lucas/create-project"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"bin/create-project"')]),t._v(",\n   "),a("span",{staticClass:"hljs-string"},[t._v('"create-project"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"bin/create-project"')]),t._v("\n },\n "),a("span",{staticClass:"hljs-string"},[t._v('"publishConfig"')]),t._v(": {\n   "),a("span",{staticClass:"hljs-string"},[t._v('"access"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"public"')]),t._v("\n },\n "),a("span",{staticClass:"hljs-string"},[t._v('"scripts"')]),t._v(": {\n   "),a("span",{staticClass:"hljs-string"},[t._v('"test"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"echo \\"Error: no test specified\\" && exit 1"')]),t._v("\n },\n "),a("span",{staticClass:"hljs-string"},[t._v('"keywords"')]),t._v(": [\n   "),a("span",{staticClass:"hljs-string"},[t._v('"cli"')]),t._v(",\n   "),a("span",{staticClass:"hljs-string"},[t._v('"create-project"')]),t._v("\n ],\n "),a("span",{staticClass:"hljs-string"},[t._v('"author"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"YOUR_AUTHOR"')]),t._v(",\n "),a("span",{staticClass:"hljs-string"},[t._v('"license"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"MIT"')]),t._v(",\n "),a("span",{staticClass:"hljs-string"},[t._v('"dependencies"')]),t._v(": {\n   "),a("span",{staticClass:"hljs-string"},[t._v('"esm"')]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v('"^3.2.18"')]),t._v("\n }\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1649"}},[t._v("这里需要注意的是 "),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1841"}},[t._v("bin")]),t._v("字段，我们注册了两个可用命令：一个是带有 npm 命名 scope 的，一个是常规的"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1843"}},[t._v("create-project")]),t._v("命令。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1650"}},[t._v("为了调试方便，我们使用"),a("a",{attrs:{href:"https://docs.npmjs.com/cli/link.html","data-nodeid":"1848"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1847"}},[t._v("npm link")])]),t._v("命令进行调试，在终端中项目目录下执行：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1651"}},[a("code",{attrs:{"data-language":"java"}},[t._v("npm link\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1652"}},[t._v("上述命令可以在全局范围内添加一个软链到当前项目中。我们执行：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1653"}},[a("code",{attrs:{"data-language":"java"}},[t._v("create-project --yes\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1654"}},[t._v("就会得到下面这样的输出：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1655"}},[a("code",{attrs:{"data-language":"java"}},[t._v("[ "),a("span",{staticClass:"hljs-string"},[t._v("'/usr/local/Cellar/node/11.6.0/bin/node'")]),t._v(",\n  "),a("span",{staticClass:"hljs-string"},[t._v("'/Users/dkundel/dev/create-project/bin/create-project'")]),t._v(",\n  "),a("span",{staticClass:"hljs-string"},[t._v("'--yes'")]),t._v(" ]\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1656"}},[t._v("该输出，就对应了代码中的"),a("a",{attrs:{href:"https://nodejs.org/api/process.html#process_process_argv","data-nodeid":"1855"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1854"}},[t._v("process.argv")])]),t._v("。")]),t._v(" "),a("h4",{attrs:{"data-nodeid":"1657"}},[t._v("解析处理命令行输入")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1658"}},[t._v("在解析处理命令行输入之前，我们需要设计命令行支持的几个选项，如下。")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"1659"}},[a("li",{attrs:{"data-nodeid":"1660"}},[a("p",{attrs:{"data-nodeid":"1661"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1859"}},[t._v("[template]")]),t._v("：支持默认的几种模板类型，用户可以通过 select 进行选择。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1662"}},[a("p",{attrs:{"data-nodeid":"1663"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1861"}},[t._v("--git")]),t._v("：等同于"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1863"}},[t._v("git init")]),t._v("去创建一个新的 Git 项目。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1664"}},[a("p",{attrs:{"data-nodeid":"1665"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1865"}},[t._v("--install")]),t._v("：支持自动下载项目依赖。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1666"}},[a("p",{attrs:{"data-nodeid":"1667"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1867"}},[t._v("--yes")]),t._v("：跳过命令行交互，直接使用默认配置。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1668"}},[t._v("我们利用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1870"}},[t._v("inquirer")]),t._v("使得命令行支持用户交互，同时使用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1872"}},[t._v("arg")]),t._v("来解析命令行参数，安装相关依赖命令：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1669"}},[a("code",{attrs:{"data-language":"java"}},[t._v("npm install inquirer arg\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1670"}},[t._v("接下来编写命令行参数解析逻辑，在"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1875"}},[t._v("cli.js")]),t._v("中添加：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1671"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" arg from "),a("span",{staticClass:"hljs-string"},[t._v("'arg'")]),t._v(";\n"),a("span",{staticClass:"hljs-comment"},[t._v("// 解析命令行参数为 options")]),t._v("\n"),a("span",{staticClass:"hljs-function"},[t._v("function "),a("span",{staticClass:"hljs-title"},[t._v("parseArgumentsIntoOptions")]),a("span",{staticClass:"hljs-params"},[t._v("(rawArgs)")]),t._v(" ")]),t._v("{\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 使用 arg 进行解析")]),t._v("\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" args = arg(\n   {\n     "),a("span",{staticClass:"hljs-string"},[t._v("'--git'")]),t._v(": Boolean,\n     "),a("span",{staticClass:"hljs-string"},[t._v("'--yes'")]),t._v(": Boolean,\n     "),a("span",{staticClass:"hljs-string"},[t._v("'--install'")]),t._v(": Boolean,\n     "),a("span",{staticClass:"hljs-string"},[t._v("'-g'")]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v("'--git'")]),t._v(",\n     "),a("span",{staticClass:"hljs-string"},[t._v("'-y'")]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v("'--yes'")]),t._v(",\n     "),a("span",{staticClass:"hljs-string"},[t._v("'-i'")]),t._v(": "),a("span",{staticClass:"hljs-string"},[t._v("'--install'")]),t._v(",\n   },\n   {\n     argv: rawArgs.slice("),a("span",{staticClass:"hljs-number"},[t._v("2")]),t._v("),\n   }\n );\n "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" {\n   skipPrompts: args["),a("span",{staticClass:"hljs-string"},[t._v("'--yes'")]),t._v("] || "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n   git: args["),a("span",{staticClass:"hljs-string"},[t._v("'--git'")]),t._v("] || "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n   template: args._["),a("span",{staticClass:"hljs-number"},[t._v("0")]),t._v("],\n   runInstall: args["),a("span",{staticClass:"hljs-string"},[t._v("'--install'")]),t._v("] || "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n }\n}\n"),a("span",{staticClass:"hljs-function"},[t._v("export function "),a("span",{staticClass:"hljs-title"},[t._v("cli")]),a("span",{staticClass:"hljs-params"},[t._v("(args)")]),t._v(" ")]),t._v("{\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 获取命令行配置")]),t._v("\n let options = parseArgumentsIntoOptions(args);\n console.log(options);\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1672"}},[t._v("上述代码很好理解，我已经加入了相关注释。接下来，我们实现使用默认配置和交互式配置选择逻辑，如下代码：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1673"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" arg from "),a("span",{staticClass:"hljs-string"},[t._v("'arg'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" inquirer from "),a("span",{staticClass:"hljs-string"},[t._v("'inquirer'")]),t._v(";\n"),a("span",{staticClass:"hljs-function"},[t._v("function "),a("span",{staticClass:"hljs-title"},[t._v("parseArgumentsIntoOptions")]),a("span",{staticClass:"hljs-params"},[t._v("(rawArgs)")]),t._v(" ")]),t._v("{\n "),a("span",{staticClass:"hljs-comment"},[t._v("// ...")]),t._v("\n}\n"),a("span",{staticClass:"hljs-function"},[t._v("async function "),a("span",{staticClass:"hljs-title"},[t._v("promptForMissingOptions")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")]),t._v(" ")]),t._v("{\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 默认使用名为 JavaScript 的模板")]),t._v("\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" defaultTemplate = "),a("span",{staticClass:"hljs-string"},[t._v("'JavaScript'")]),t._v(";\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 使用默认模板则直接返回")]),t._v("\n "),a("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (options.skipPrompts) {\n   "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" {\n     ...options,\n     template: options.template || defaultTemplate,\n   };\n }\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 准备交互式问题 ")]),t._v("\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" questions = [];\n "),a("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (!options.template) {\n   questions.push({\n     type: "),a("span",{staticClass:"hljs-string"},[t._v("'list'")]),t._v(",\n     name: "),a("span",{staticClass:"hljs-string"},[t._v("'template'")]),t._v(",\n     message: "),a("span",{staticClass:"hljs-string"},[t._v("'Please choose which project template to use'")]),t._v(",\n     choices: ["),a("span",{staticClass:"hljs-string"},[t._v("'JavaScript'")]),t._v(", "),a("span",{staticClass:"hljs-string"},[t._v("'TypeScript'")]),t._v("],\n     "),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(": defaultTemplate,\n   });\n }\n "),a("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (!options.git) {\n   questions.push({\n     type: "),a("span",{staticClass:"hljs-string"},[t._v("'confirm'")]),t._v(",\n     name: "),a("span",{staticClass:"hljs-string"},[t._v("'git'")]),t._v(",\n     message: "),a("span",{staticClass:"hljs-string"},[t._v("'Initialize a git repository?'")]),t._v(",\n     "),a("span",{staticClass:"hljs-keyword"},[t._v("default")]),t._v(": "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n   });\n }\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 使用 inquirer 进行交互式查询，并获取用户答案选项")]),t._v("\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" answers = await inquirer.prompt(questions);\n "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" {\n   ...options,\n   template: options.template || answers.template,\n   git: options.git || answers.git,\n };\n}\n"),a("span",{staticClass:"hljs-function"},[t._v("export async function "),a("span",{staticClass:"hljs-title"},[t._v("cli")]),a("span",{staticClass:"hljs-params"},[t._v("(args)")]),t._v(" ")]),t._v("{\n let options = parseArgumentsIntoOptions(args);\n options = "),a("span",{staticClass:"hljs-function"},[t._v("await "),a("span",{staticClass:"hljs-title"},[t._v("promptForMissingOptions")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")])]),t._v(";\n console.log(options);\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1674"}},[t._v("这样一来，我们就可以获取到类似：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1675"}},[a("code",{attrs:{"data-language":"java"}},[t._v("{\n skipPrompts: "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n    git: "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n    template: "),a("span",{staticClass:"hljs-string"},[t._v("'JavaScript'")]),t._v(",\n    runInstall: "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v("\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1676"}},[t._v("相关的配置了。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1677"}},[t._v("下面我们需要完成下载模板到本地的逻辑，我们事先准备好两种名为"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1881"}},[t._v("typescript")]),t._v("和"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1883"}},[t._v("javascript")]),t._v("的模板，并将相关的模板存储在项目的根目录中。当然你在实际开发应用中，可以内置更多的模板。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1678"}},[t._v("我们使用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1886"}},[t._v("ncp")]),t._v("包实现跨平台递归拷贝文件，使用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1888"}},[t._v("chalk")]),t._v("做个性化输出。安装相关依赖如下：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1679"}},[a("code",{attrs:{"data-language":"java"}},[t._v("npm install ncp chalk\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1680"}},[t._v("在"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1891"}},[t._v("src/")]),t._v("目录下，创建新的文件"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1893"}},[t._v("main.js")]),t._v("，代码如下：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1681"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" chalk from "),a("span",{staticClass:"hljs-string"},[t._v("'chalk'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" fs from "),a("span",{staticClass:"hljs-string"},[t._v("'fs'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" ncp from "),a("span",{staticClass:"hljs-string"},[t._v("'ncp'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" path from "),a("span",{staticClass:"hljs-string"},[t._v("'path'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" { promisify } from "),a("span",{staticClass:"hljs-string"},[t._v("'util'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" access = promisify(fs.access);\n"),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" copy = promisify(ncp);\n"),a("span",{staticClass:"hljs-comment"},[t._v("// 递归拷贝文件")]),t._v("\n"),a("span",{staticClass:"hljs-function"},[t._v("async function "),a("span",{staticClass:"hljs-title"},[t._v("copyTemplateFiles")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")]),t._v(" ")]),t._v("{\n "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" copy(options.templateDirectory, options.targetDirectory, {\n   clobber: "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n });\n}\n"),a("span",{staticClass:"hljs-comment"},[t._v("// 创建项目")]),t._v("\n"),a("span",{staticClass:"hljs-function"},[t._v("export async function "),a("span",{staticClass:"hljs-title"},[t._v("createProject")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")]),t._v(" ")]),t._v("{\n options = {\n   ...options,\n   targetDirectory: options.targetDirectory || process.cwd(),\n };\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" currentFileUrl = "),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(".meta.url;\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" templateDir = path.resolve(\n   "),a("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" URL(currentFileUrl).pathname,\n   "),a("span",{staticClass:"hljs-string"},[t._v("'../../templates'")]),t._v(",\n   options.template.toLowerCase()\n );\n options.templateDirectory = templateDir;\n "),a("span",{staticClass:"hljs-keyword"},[t._v("try")]),t._v(" {\n   "),a("span",{staticClass:"hljs-comment"},[t._v("// 判断模板是否存在")]),t._v("\n   "),a("span",{staticClass:"hljs-function"},[t._v("await "),a("span",{staticClass:"hljs-title"},[t._v("access")]),a("span",{staticClass:"hljs-params"},[t._v("(templateDir, fs.constants.R_OK)")])]),t._v(";\n } "),a("span",{staticClass:"hljs-keyword"},[t._v("catch")]),t._v(" (err) {\n   "),a("span",{staticClass:"hljs-comment"},[t._v("// 模板不存在 ")]),t._v("\n   console.error("),a("span",{staticClass:"hljs-string"},[t._v("'%s Invalid template name'")]),t._v(", chalk.red.bold("),a("span",{staticClass:"hljs-string"},[t._v("'ERROR'")]),t._v("));\n   process.exit("),a("span",{staticClass:"hljs-number"},[t._v("1")]),t._v(");\n }\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 拷贝模板")]),t._v("\n "),a("span",{staticClass:"hljs-function"},[t._v("await "),a("span",{staticClass:"hljs-title"},[t._v("copyTemplateFiles")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")])]),t._v(";\n console.log("),a("span",{staticClass:"hljs-string"},[t._v("'%s Project ready'")]),t._v(", chalk.green.bold("),a("span",{staticClass:"hljs-string"},[t._v("'DONE'")]),t._v("));\n "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" "),a("span",{staticClass:"hljs-keyword"},[t._v("true")]),t._v(";\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"4446"}},[t._v("上述代码我们通过"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import.meta","data-nodeid":"4450"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"4449"}},[t._v("import.meta.url")])]),t._v("来获取当前模块的 URL 路径，并通过"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"4452"}},[t._v("fs.constants.R_OK")]),t._v("判断对应模板是否存在。此时"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"4454"}},[t._v("cli.js")]),t._v("关键内容为：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1683"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" arg from "),a("span",{staticClass:"hljs-string"},[t._v("'arg'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" inquirer from "),a("span",{staticClass:"hljs-string"},[t._v("'inquirer'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" { createProject } from "),a("span",{staticClass:"hljs-string"},[t._v("'./main'")]),t._v(";\n"),a("span",{staticClass:"hljs-function"},[t._v("function "),a("span",{staticClass:"hljs-title"},[t._v("parseArgumentsIntoOptions")]),a("span",{staticClass:"hljs-params"},[t._v("(rawArgs)")]),t._v(" ")]),t._v("{\n"),a("span",{staticClass:"hljs-comment"},[t._v("// ...")]),t._v("\n}\n"),a("span",{staticClass:"hljs-function"},[t._v("async function "),a("span",{staticClass:"hljs-title"},[t._v("promptForMissingOptions")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")]),t._v(" ")]),t._v("{\n"),a("span",{staticClass:"hljs-comment"},[t._v("// ...")]),t._v("\n}\n"),a("span",{staticClass:"hljs-function"},[t._v("export async function "),a("span",{staticClass:"hljs-title"},[t._v("cli")]),a("span",{staticClass:"hljs-params"},[t._v("(args)")]),t._v(" ")]),t._v("{\n let options = parseArgumentsIntoOptions(args);\n options = "),a("span",{staticClass:"hljs-function"},[t._v("await "),a("span",{staticClass:"hljs-title"},[t._v("promptForMissingOptions")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")])]),t._v(";\n "),a("span",{staticClass:"hljs-function"},[t._v("await "),a("span",{staticClass:"hljs-title"},[t._v("createProject")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")])]),t._v(";\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1684"}},[t._v("接下来，我们需要完成"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1905"}},[t._v("git")]),t._v("的初始化以及依赖安装工作，这时候需要用到以下内容。")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"1685"}},[a("li",{attrs:{"data-nodeid":"1686"}},[a("p",{attrs:{"data-nodeid":"1687"}},[a("a",{attrs:{href:"http://npm.im/execa","data-nodeid":"1909"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1908"}},[t._v("execa")])]),t._v("：允许开发中使用类似"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1911"}},[t._v("git")]),t._v("的外部命令。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1688"}},[a("p",{attrs:{"data-nodeid":"1689"}},[a("a",{attrs:{href:"http://npm.im/pkg-install","data-nodeid":"1915"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1914"}},[t._v("pkg-install")])]),t._v("：使用"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1917"}},[t._v("yarn install")]),t._v("或"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1919"}},[t._v("npm install")]),t._v("安装依赖。")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1690"}},[a("p",{attrs:{"data-nodeid":"1691"}},[a("a",{attrs:{href:"http://npm.im/listr","data-nodeid":"1923"}},[a("code",{attrs:{"data-backticks":"1","data-nodeid":"1922"}},[t._v("listr")])]),t._v("：给出当前进度 progress。")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1692"}},[t._v("执行安装依赖：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1693"}},[a("code",{attrs:{"data-language":"java"}},[t._v("npm install execa pkg-install listr\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1694"}},[t._v("更新"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1927"}},[t._v("main.js")]),t._v("为：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1695"}},[a("code",{attrs:{"data-language":"java"}},[a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" chalk from "),a("span",{staticClass:"hljs-string"},[t._v("'chalk'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" fs from "),a("span",{staticClass:"hljs-string"},[t._v("'fs'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" ncp from "),a("span",{staticClass:"hljs-string"},[t._v("'ncp'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" path from "),a("span",{staticClass:"hljs-string"},[t._v("'path'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" { promisify } from "),a("span",{staticClass:"hljs-string"},[t._v("'util'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" execa from "),a("span",{staticClass:"hljs-string"},[t._v("'execa'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" Listr from "),a("span",{staticClass:"hljs-string"},[t._v("'listr'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(" { projectInstall } from "),a("span",{staticClass:"hljs-string"},[t._v("'pkg-install'")]),t._v(";\n"),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" access = promisify(fs.access);\n"),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" copy = promisify(ncp);\n"),a("span",{staticClass:"hljs-comment"},[t._v("// 拷贝模板")]),t._v("\n"),a("span",{staticClass:"hljs-function"},[t._v("async function "),a("span",{staticClass:"hljs-title"},[t._v("copyTemplateFiles")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")]),t._v(" ")]),t._v("{\n "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" copy(options.templateDirectory, options.targetDirectory, {\n   clobber: "),a("span",{staticClass:"hljs-keyword"},[t._v("false")]),t._v(",\n });\n}\n"),a("span",{staticClass:"hljs-comment"},[t._v("// 初始化 git")]),t._v("\n"),a("span",{staticClass:"hljs-function"},[t._v("async function "),a("span",{staticClass:"hljs-title"},[t._v("initGit")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")]),t._v(" ")]),t._v("{\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 执行 git init")]),t._v("\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" result = "),a("span",{staticClass:"hljs-function"},[t._v("await "),a("span",{staticClass:"hljs-title"},[t._v("execa")]),a("span",{staticClass:"hljs-params"},[t._v("("),a("span",{staticClass:"hljs-string"},[t._v("'git'")]),t._v(", ["),a("span",{staticClass:"hljs-string"},[t._v("'init'")]),t._v("], {\n   cwd: options.targetDirectory,\n })")])]),t._v(";\n "),a("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (result.failed) {\n   "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" Promise.reject("),a("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" Error("),a("span",{staticClass:"hljs-string"},[t._v("'Failed to initialize git'")]),t._v("));\n }\n "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(";\n}\n"),a("span",{staticClass:"hljs-comment"},[t._v("// 创建项目")]),t._v("\n"),a("span",{staticClass:"hljs-function"},[t._v("export async function "),a("span",{staticClass:"hljs-title"},[t._v("createProject")]),a("span",{staticClass:"hljs-params"},[t._v("(options)")]),t._v(" ")]),t._v("{\n options = {\n   ...options,\n   targetDirectory: options.targetDirectory || process.cwd()\n };\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" templateDir = path.resolve(\n   "),a("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" URL("),a("span",{staticClass:"hljs-keyword"},[t._v("import")]),t._v(".meta.url).pathname,\n   "),a("span",{staticClass:"hljs-string"},[t._v("'../../templates'")]),t._v(",\n   options.template\n );\n options.templateDirectory = templateDir;\n "),a("span",{staticClass:"hljs-keyword"},[t._v("try")]),t._v(" {\n   "),a("span",{staticClass:"hljs-comment"},[t._v("// 判断模板是否存在")]),t._v("\n   "),a("span",{staticClass:"hljs-function"},[t._v("await "),a("span",{staticClass:"hljs-title"},[t._v("access")]),a("span",{staticClass:"hljs-params"},[t._v("(templateDir, fs.constants.R_OK)")])]),t._v(";\n } "),a("span",{staticClass:"hljs-keyword"},[t._v("catch")]),t._v(" (err) {\n   console.error("),a("span",{staticClass:"hljs-string"},[t._v("'%s Invalid template name'")]),t._v(", chalk.red.bold("),a("span",{staticClass:"hljs-string"},[t._v("'ERROR'")]),t._v("));\n   process.exit("),a("span",{staticClass:"hljs-number"},[t._v("1")]),t._v(");\n }\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 声明 tasks")]),t._v("\n "),a("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" tasks = "),a("span",{staticClass:"hljs-keyword"},[t._v("new")]),t._v(" Listr([\n   {\n     title: "),a("span",{staticClass:"hljs-string"},[t._v("'Copy project files'")]),t._v(",\n     task: () => copyTemplateFiles(options),\n   },\n   {\n     title: "),a("span",{staticClass:"hljs-string"},[t._v("'Initialize git'")]),t._v(",\n     task: () => initGit(options),\n     enabled: () => options.git,\n   },\n   {\n     title: "),a("span",{staticClass:"hljs-string"},[t._v("'Install dependencies'")]),t._v(",\n     task: () =>\n       projectInstall({\n         cwd: options.targetDirectory,\n       }),\n     skip: () =>\n       !options.runInstall\n         ? "),a("span",{staticClass:"hljs-string"},[t._v("'Pass --install to automatically install dependencies'")]),t._v("\n         : undefined,\n   },\n ]);\n "),a("span",{staticClass:"hljs-comment"},[t._v("// 并行执行 tasks")]),t._v("\n await tasks.run();\n console.log("),a("span",{staticClass:"hljs-string"},[t._v("'%s Project ready'")]),t._v(", chalk.green.bold("),a("span",{staticClass:"hljs-string"},[t._v("'DONE'")]),t._v("));\n "),a("span",{staticClass:"hljs-keyword"},[t._v("return")]),t._v(" "),a("span",{staticClass:"hljs-keyword"},[t._v("true")]),t._v(";\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1696"}},[t._v("这样一来，我们的命令行就大功告成了。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1697"}},[t._v("接下来我们主要谈谈模板维护问题，上述实现中，模板维护在了本地。为了更大范围的合作，模板可以共享到 GitHub 中。我们可以在 package.json 文件中声明 files 字段，如下所示：")]),t._v(" "),a("pre",{staticClass:"lang-java",attrs:{"data-nodeid":"1698"}},[a("code",{attrs:{"data-language":"java"}},[t._v("},\n "),a("span",{staticClass:"hljs-string"},[t._v('"files"')]),t._v(": [\n   "),a("span",{staticClass:"hljs-string"},[t._v('"bin/"')]),t._v(",\n   "),a("span",{staticClass:"hljs-string"},[t._v('"src/"')]),t._v(",\n   "),a("span",{staticClass:"hljs-string"},[t._v('"templates/"')]),t._v("\n ]\n}\n")])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1699"}},[t._v("以此来声明哪些文件可以被"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1932"}},[t._v("npm publish")]),t._v("出去。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1700"}},[t._v("另外一种做法是将模板单独维护到一个 GitHub 仓库当中。在创建一个项目时，我们使用 "),a("a",{attrs:{href:"https://www.npmjs.com/package/download-git-repo","data-nodeid":"1937"}},[t._v("download-git-repo")]),t._v("来下载模板。")]),t._v(" "),a("h3",{attrs:{"data-nodeid":"1701"}},[t._v("从命令行到万能脚手架")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1702"}},[t._v("前面我们分析了一个命令行的实现和开发原理，这些内容并不复杂。但如何从一个命令行升级到一个万能脚手架呢？我们继续探讨。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1703"}},[t._v("使用命令行启动并创建一个基于模板的项目只能说是一个脚手架的雏形。对比大家熟悉的"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1942"}},[t._v("vue-cli")]),t._v("、"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1944"}},[t._v("create-react-app")]),t._v("、"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1946"}},[t._v("@tarojs/cli")]),t._v("、"),a("code",{attrs:{"data-backticks":"1","data-nodeid":"1948"}},[t._v("umi")]),t._v("等，我们还需要从可伸缩性、用户友好性方面考虑：")]),t._v(" "),a("ul",{attrs:{"data-nodeid":"1704"}},[a("li",{attrs:{"data-nodeid":"1705"}},[a("p",{attrs:{"data-nodeid":"1706"}},[t._v("如何使模板支持版本管理")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1707"}},[a("p",{attrs:{"data-nodeid":"1708"}},[t._v("模板如何进行扩展")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1709"}},[a("p",{attrs:{"data-nodeid":"1710"}},[t._v("如何进行版本检查和更新")])]),t._v(" "),a("li",{attrs:{"data-nodeid":"1711"}},[a("p",{attrs:{"data-nodeid":"1712"}},[t._v("如何自定义构建")])])]),t._v(" "),a("p",{attrs:{"data-nodeid":"1713"}},[t._v("下面我们分别来讨论。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1714"}},[t._v("模板支持版本管理可以使用 npm 维护模板，这样借助 npm 的版本管理，我们可以天然地支持不同版本的模板。当然在脚手架的设计中，要加入"),a("strong",{attrs:{"data-nodeid":"1960"}},[t._v("对版本的选择和处理")]),t._v("。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1715"}},[t._v("如前文所说，模板扩展可以借助中心化手段，集成开发者力量，提供模板市场。这里需要注意的是，针对不同模板或功能区块的"),a("strong",{attrs:{"data-nodeid":"1966"}},[t._v("可插拔性")]),t._v("是非常重要的。下面我们会具体展开。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"3640"}},[t._v("版本检查可以使用 npm view @lucas/create-project version\\ 来进行版本检查，并根据环境版本，提示用户更新。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"2823"}},[t._v("构建是一个老大难问题，不同项目的构建需求是不同的。参照"),a("a",{attrs:{href:"https://kaiwu.lagou.com/course/courseInfo.htm?courseId=584#/detail/pc?id=5952","data-nodeid":"2827"}},[t._v("第 23 讲“npm scripts：打造一体化的构建和部署流程”")]),t._v("所讲，不同构建脚本可以考虑"),a("strong",{attrs:{"data-nodeid":"2837"}},[t._v("单独抽象，提供可插拔式封装")]),t._v("。比如"),a("a",{attrs:{href:"https://github.com/yanhaijing/jslib-base/tree/master/packages","data-nodeid":"2835"}},[t._v("jslib-base")]),t._v("这个库的设计，这也是一个“万能脚手架”。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1718"}},[t._v("我们具体来看，使用脚手架初始化一个项目的过程，本质是根据输入信息进行模板填充。比如，如果开发者选择使用 TypeScript 以及英语环境构建项目，并使用 rollup 进行构建。那么核心流程中在初始化 rollup.config.js 文件时，我们读取 rollup.js.tmpl，并将相关信息（比如对 TypeScript 的编译）填写到模板中。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1719"}},[t._v("类似的情况还有初始化 .eslintrc.ts.json、package.json、CHANGELOG.en.md、README.en.md，以及 doc.en.md 等。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1720"}},[t._v("所有这些文件的生成过程都需要"),a("strong",{attrs:{"data-nodeid":"1991"}},[t._v("可插拔，更理想的是，这些插件是一个独立的运行时")]),t._v("。因此我们可以将每一个脚手架文件（即模板文件）的初始化视作一个独立的应用，由命令行统一指挥调度。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1721"}},[t._v("比如 "),a("a",{attrs:{href:"https://github.com/yanhaijing/jslib-base/tree/master/packages","data-nodeid":"1995"}},[t._v("jslib-base")]),t._v(" 这个库对于 rollup 构建的处理，支持开发者传入 option，由命令行处理函数，结合不同的配置版本进行自定义分配。具体代码如下：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" util "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@js-lib/util'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" option")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// type 为 js 和 ts 两种")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// module 分为：umd/esm/commonjs")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" module "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("prev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rollup 基本配置")]),t._v("\n    util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyTmpl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./template/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/rollup.js.tmpl")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'config/rollup.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// umd 模式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("umd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./template/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/rollup.config.aio.js")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'config/rollup.config.aio.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// esm 模式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("esm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./template/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/rollup.config.esm.js")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'config/rollup.config.esm.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// commonjs 模式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("commonjs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./template/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/rollup.config.js")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'config/rollup.config.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeTmpl2JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./template/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/package.json.tmpl")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'package.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        option"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./template/js/.babelrc")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.babelrc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyFile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./template/ts/tsconfig.json")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cmdPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsconfig.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",{attrs:{"data-nodeid":"1723"}},[t._v("如上代码，根据用户输入，使用了不同版本的 rollup 构建内容。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1724"}},[t._v("相信你了解了这些内容，对于实现一个自己的 create-react-app、vue-cli 会更有心得和启发。")]),t._v(" "),a("h3",{attrs:{"data-nodeid":"1725"}},[t._v("总结")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1726"}},[t._v("这一讲我们从开发一个命令行入手，分析了实现一个脚手架的方方面面。实现一个企业级脚手架需要不断打磨和优化，不断增强用户体验和可操作性，比如处理边界情况、终端提示等。更重要的是，对构建逻辑的抽象和封装，根据业务需求，不断扩展命令和模板。")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1727"}},[t._v("本讲内容总结如下：")]),t._v(" "),a("p",{attrs:{"data-nodeid":"1728"}},[a("img",{attrs:{src:"https://s0.lgstatic.com/i/image6/M01/17/03/Cgp9HWBHK1WAeFWWAAdEzv-BDFI037.png",alt:"前端基建 金句.png","data-nodeid":"2004"}})]),t._v(" "),a("p",{attrs:{"data-nodeid":"1729"}},[t._v("从 0 到 1 简单，但是从 1 开始出发，就需要开发者不断思考和总结。下一讲我们将开启 Node.js 的学习，来实现一个 SSR 应用。我们会直入正题，不再过多学习 Node.js 的基础内容，也请你提前做好准备。")]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"精选评论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#精选评论"}},[t._v("#")]),t._v(" 精选评论")]),t._v(" "),a("h5",{attrs:{id:"哲"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#哲"}},[t._v("#")]),t._v(" *哲")]),t._v(" "),a("blockquote",[a("p",[t._v("执行 npm link 时出错：npm ERR! path /usr/local/lib/node_modules/create-project/bin/create-projectnpm ERR! errno -2npm ERR! enoent ENOENT: no such file or directory, chmod '/usr/local/lib/node_modules/create-project/bin/create-project'")])]),t._v(" "),a("h6",{attrs:{id:"讲师回复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#讲师回复"}},[t._v("#")]),t._v("     讲师回复")]),t._v(" "),a("blockquote",[a("p",[t._v("    从报错来看，是找不到该路径对应的文件，先确认一下改路径下是否有文件，再看一下是否有创建文件的权限")])]),t._v(" "),a("h5",{attrs:{id:"斌"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#斌"}},[t._v("#")]),t._v(" *斌")]),t._v(" "),a("blockquote",[a("p",[t._v("有 github repo 吗？")])]),t._v(" "),a("h6",{attrs:{id:"编辑回复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编辑回复"}},[t._v("#")]),t._v("     编辑回复")]),t._v(" "),a("blockquote",[a("p",[t._v("    注意看超链接的地方，相关地址都在哈~")])])])}),[],!1,null,null,null);a.default=e.exports}}]);